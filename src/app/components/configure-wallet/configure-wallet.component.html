<h2 class="uk-heading-divider">{{ 'configure-wallet' | translate }}</h2>

<div *ngIf="isConfigured() && (activePanel === panels.create || activePanel === panels.import)" class="uk-alert uk-alert-danger">
  <b>{{ 'wallet-configured.you-already-have-a-wallet-configured' | translate }}</b><br>
  {{ 'wallet-configured.be-100-certain' | translate }}<br>
  <b>{{ 'wallet-configured.without-it-any-funds-unrecoverable' | translate }}</b>
</div>

<div uk-grid *ngIf="activePanel === panels.create || activePanel === panels.import">
  <div class="uk-width-1-1">
    <div class="uk-button-group uk-width-1-1">
      <button (click)="setPanel(0)" class="uk-button uk-width-1-2" [ngClass]="{ 'uk-button-primary': activePanel === panels.create, 'uk-button-secondary': activePanel !== panels.create }">{{ 'create-new-wallet' | translate }}</button>
      <button (click)="setPanel(1)" class="uk-button uk-width-1-2" [ngClass]="{ 'uk-button-primary': activePanel === panels.import, 'uk-button-secondary': activePanel !== panels.import }">{{ 'import-existing-wallet' | translate }}</button>
    </div>
  </div>
</div>

<div class="uk-card uk-card-default" *ngIf="activePanel === panels.create">
  <div class="uk-card-body">
    <p>
      {{ 'when-you-create-a-new-wallet-a-new-nano-seed' | translate }}
    </p>
    <div class="uk-alert-primary" uk-alert>
      <p>{{ 'make-sure-you-back-up-your-seed' | translate }}</p>
    </div>
  </div>
  <div class="uk-card-footer uk-text-right">
    <button class="uk-button uk-button-primary uk-width-auto@s uk-width-1-1" (click)="setPasswordInit()">{{ 'create-wallet' | translate }}</button>
  </div>
</div>

<div class="uk-card uk-card-default" *ngIf="activePanel === panels.import">
  <div class="uk-card-body">
    <div uk-grid>
      <div class="uk-width-1-1">
        <div class="uk-form-horizontal">
          <div class="uk-margin">
            <label class="uk-form-label" for="form-horizontal-select">{{ 'import-type' | translate }}</label>
            <div class="uk-form-controls">
              <select class="uk-select" [(ngModel)]="selectedImportOption" id="form-horizontal-select">
                <option *ngFor="let option of importOptions" [value]="option.value">{{ option.name }}</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>

    <hr class="uk-divider-icon" style="margin-top: 10px;">

    <div class="uk-alert-primary" uk-alert style="max-width: 700px;" *ngIf="(selectedImportOption === 'mnemonic') || (selectedImportOption === 'bip39-mnemonic')">
      <i><span uk-icon="icon: info;" style="vertical-align: 2px;"></span> {{ 'note-for-ledger-device-owners.title' | translate }}</i>
      <p>
        {{ 'note-for-ledger-device-owners.description' | translate }}
      </p>
    </div>

    <div uk-grid *ngIf="selectedImportOption === 'file'">
      <div class="uk-width-1-1">
        <p>
          {{ 'if-wallet-file' | translate }}
        </p>
      </div>
    </div>
    <div uk-grid *ngIf="selectedImportOption === 'seed'" class="uk-margin-top">
      <div class="uk-width-1-1">
        <p>
          {{ 'enter-your-seed-from-any-nano-wallet-to-import-it-below' | translate }}
        </p>
        <div class="uk-inline uk-width-1-1">
          <a class="uk-form-icon uk-form-icon-flip" uk-icon="icon: camera" (click)="openQR('seed1','hash')" uk-tooltip [title]="'scan-qr-code' | translate"></a>
          <input type="text" class="uk-input" (keyup.enter)="setPasswordInit()" [(ngModel)]="importSeedModel" placeholder="64 hex character Nano Seed">
        </div>
      </div>
    </div>
    <div uk-grid *ngIf="selectedImportOption === 'mnemonic'" class="uk-margin-top">
      <div class="uk-width-1-1">
        <p>
          {{ 'enter-mnemonic' | translate }}
        </p>
        <div class="uk-inline uk-width-1-1">
          <a class="uk-form-icon uk-form-icon-flip" uk-icon="icon: camera" (click)="openQR('mnemo1','mnemonic')" uk-tooltip [title]="'scan-qr-code' | translate"></a>
          <textarea class="uk-textarea" rows="3" [(ngModel)]="importSeedMnemonicModel" placeholder="24-words mnemonic"></textarea>
        </div>
      </div>
    </div>
    <div uk-grid *ngIf="selectedImportOption === 'bip39-mnemonic'" class="uk-margin-top">
      <div class="uk-width-1-1">
        <p>
          {{ 'enter-bip39-mnemonic' | translate }}
        </p>
        <div class="uk-form-horizontal">
          <div class="uk-margin">
            <label class="uk-form-label" for="form-horizontal-select">BIP39 Mnemonic</label>
            <div class="uk-form-controls">
              <div class="uk-inline uk-width-expand">
                <a class="uk-form-icon uk-form-icon-flip" uk-icon="icon: camera" (click)="openQR('mnemo2','mnemonic')" uk-tooltip [title]="'scan-qr-code' | translate"></a>
                <textarea class="uk-textarea" rows="2" [(ngModel)]="importSeedBip39MnemonicModel" placeholder="12,15,18,21 or 24-words mnemonic" autocomplete="off"></textarea>
              </div>
           </div>
          </div>
        </div>
        <div class="uk-form-horizontal">
          <div class="uk-margin">
            <label class="uk-form-label" for="form-horizontal-select">{{ 'account-index' | translate }} <span uk-icon="icon: info;" uk-tooltip title="{{ 'the-wallet-will-be-imported-as-a-single-private-key-for-the-account-index-you-provide' | translate }}"></span></label>
            <div class="uk-form-controls">
              <input type="text" class="uk-input uk-margin-small-bottom {{validIndex ? '':'uk-form-danger'}}" (keyup.enter)="setPasswordInit()" [(ngModel)]="importSeedBip39MnemonicIndexModel" (ngModelChange)="accountIndexChange(importSeedBip39MnemonicIndexModel)" maxLength="10" placeholder="0 to {{indexMax}}" autocomplete="off">
            </div>
          </div>
        </div>
        <div class="uk-form-horizontal">
          <div class="uk-margin">
            <label class="uk-form-label" for="form-horizontal-select">{{ 'bip39-passphrase' | translate }} <span uk-icon="icon: info;" uk-tooltip title="{{ 'required-only-if-the-bip39-seed-is-protected-by-a-password-or-passphrase' | translate }}"></span></label>
            <div class="uk-form-controls">
              <input type="password" class="uk-input" (keyup.enter)="setPasswordInit()" [(ngModel)]="importSeedBip39MnemonicPasswordModel" placeholder="Optional" autocomplete="off">
            </div>
          </div>
        </div>
      </div>
    </div>
    <div uk-grid *ngIf="selectedImportOption === 'ledger'" class="uk-margin-top">
      <div class="uk-width-1-1">
        <p>
          {{ 'make-sure-you-have-the-nano-app-installed' | translate }}<br> 
          <a href="https://docs.nault.cc/2020/08/04/ledger-guide.html" target="_blank" rel="noopener noreferrer">{{ 'ledger-nault-user-guide-and-troubleshooting' | translate }}</a><br>
          <br>
        </p>
        <div *ngIf="!ledgerService.supportsUSB" class="uk-alert uk-alert-danger">
          <b>{{ 'unsupported-browser.title' | translate }}</b><br>
          {{ 'configure-wallet.unsupported-browser.browser-does-not-support-usb-communication' | translate }}<br>
          {{ 'unsupported-browser.note-ios-is-currently-unsupported' | translate }}
        </div>
        <div *ngIf="ledgerService.supportsUSB">
          <div *ngIf="ledger.status === ledgerStatus.NOT_CONNECTED" class="uk-alert uk-alert-warning">
            <b>{{ 'ledger-device-not-connected.title' | translate }}</b><br>
            {{ 'ledger-device-not-connected.connect-your-ledger-device' | translate }}<br>
            <span *ngIf=!ledgerService.supportsBluetooth>{{ 'ledger-device-not-connected.bluetooth-is-currently-not-supported-by-your-browser' | translate }} <a href="https://github.com/Nault/Nault/releases/latest" target="_blank" rel="noopener noreferrer">{{ 'download' | translate }}</a></span>
          </div>
          <div *ngIf="ledger.status === ledgerStatus.LOCKED" class="uk-alert uk-alert-warning">
            <b>{{ 'ledger-device-locked.title' | translate }}</b><br>
            {{ 'ledger-device-locked.unlock-your-ledger-device' | translate }}
          </div>
          <div *ngIf="ledger.status === ledgerStatus.READY" class="uk-alert uk-alert-success">
            <b>{{ 'ledger-device-ready.title' | translate }}</b><br>
            {{ 'ledger-device-ready.press-the-import-button-below' | translate }}
          </div>
        </div>
      </div>
    </div>
    <div uk-grid *ngIf="selectedImportOption === 'privateKey'" class="uk-margin-top">
      <div class="uk-width-1-1">
        <p>
          {{ 'enter-your-nano-private-key-below' | translate }}
        </p>
        <div class="uk-inline uk-width-1-1">
          <a class="uk-form-icon uk-form-icon-flip" uk-icon="icon: camera" (click)="openQR('priv1','hash')" uk-tooltip [title]="'scan-qr-code' | translate"></a>
          <input type="text" class="uk-input" (keyup.enter)="setPasswordInit()" [(ngModel)]="importPrivateKeyModel" placeholder="64 hex character Nano Private Key">
        </div>
      </div>
    </div>
    <div uk-grid *ngIf="selectedImportOption === 'expandedKey'" class="uk-margin-top">
      <div class="uk-width-1-1">
        <p>
          {{ 'enter-your-expanded-private-key-below' | translate }}
        </p>
        <div class="uk-inline uk-width-1-1">
          <a class="uk-form-icon uk-form-icon-flip" uk-icon="icon: camera" (click)="openQR('expanded1','hash')" uk-tooltip [title]="'scan-qr-code' | translate"></a>
          <input type="text" class="uk-input" (keyup.enter)="setPasswordInit()" [(ngModel)]="importExpandedKeyModel" placeholder="64 or 128 hex character Nano Expanded Private Key">
        </div>
      </div>
    </div>
  </div>
  <div class="uk-card-footer uk-text-right nlt-button-group">
    <div *ngIf="selectedImportOption === 'file'" class="js-upload uk-width-auto@s uk-width-1-1" uk-form-custom style="display: inline-block;">
      <input type="file" id="import-from-file" (change)="importFromFile($event.target.files)" multiple>
      <button class="uk-button uk-button-primary uk-width-auto@s uk-width-1-1" type="button" tabindex="-1">{{ 'import' | translate }}</button>
    </div>
    <button *ngIf="selectedImportOption === 'mnemonic'" class="uk-button uk-button-primary uk-width-auto@s uk-width-1-1" (click)="setPasswordInit()">{{ 'import' | translate }}</button>
    <button *ngIf="selectedImportOption === 'bip39-mnemonic'" class="uk-button uk-button-primary uk-width-auto@s uk-width-1-1" [disabled]="!validIndex" (click)="setPasswordInit()">{{ 'import' | translate }}</button>
    <button *ngIf="selectedImportOption === 'seed'" class="uk-button uk-button-primary uk-width-auto@s uk-width-1-1" (click)="setPasswordInit()">{{ 'import' | translate }}</button>
    <button *ngIf="selectedImportOption === 'ledger' && ledger.status === ledgerStatus.NOT_CONNECTED" [disabled]="!ledgerService.supportsUSB" class="uk-button uk-button-primary uk-width-auto@s uk-width-1-1" (click)="connectLedgerByUsb()">{{ 'connect-via-usb' | translate }}</button>
    <button *ngIf="selectedImportOption === 'ledger' && ledger.status === ledgerStatus.NOT_CONNECTED" [disabled]="!ledgerService.supportsBluetooth" class="uk-button uk-button-primary uk-width-auto@s uk-width-1-1" (click)="connectLedgerByBluetooth()">{{ 'connect-via-bluetooth' | translate }}</button>
    <button *ngIf="selectedImportOption === 'ledger' && ledger.status !== ledgerStatus.NOT_CONNECTED" class="uk-button uk-button-primary uk-width-auto@s uk-width-1-1" (click)="importLedgerWallet(true)">{{ 'refresh-ledger-status' | translate }}</button>
    <button *ngIf="selectedImportOption === 'privateKey'" class="uk-button uk-button-primary uk-width-auto@s uk-width-1-1" (click)="setPasswordInit()">{{ 'import' | translate }}</button>
    <button *ngIf="selectedImportOption === 'expandedKey'" class="uk-button uk-button-primary uk-width-auto@s uk-width-1-1" (click)="setPasswordInit()">{{ 'import' | translate }}</button>
  </div>
</div>



<div class="uk-card uk-card-default" *ngIf="activePanel === panels.backup">
  <div class="uk-card-header">
    <h3 class="uk-card-title">{{ 'save-wallet-backup' | translate }}</h3>
  </div>
  <div class="uk-card-body">
    <p>
      {{ 'below-is-the-seed-and-mnemonic-backup' | translate }}
    </p>
    <div class="uk-alert-danger uk-alert-primary">
      {{ 'backupseed.make-sure-to-write-down-your-seed' | translate }} <strong>{{ 'backupseed.never-share-it-with-anyone' | translate }}</strong><br>
      {{ 'backupseed.it-is-the-master-key-to-all-of-your-accounts' | translate }}<br>
    </div>
    <br>

    <div uk-grid>
      <div class="uk-width-1-4">{{ 'nano-seed' | translate }}</div>
      <div class="uk-width-3-4 uk-text-truncate">
        {{ newWalletSeed }}<br>
        <a title="Copy Seed To Clipboard" ngxClipboard [cbContent]="newWalletSeed" (cbOnSuccess)="copied()" uk-tooltip>{{ 'copy-to-clipboard' | translate }}</a>
      </div>
    </div>

    <hr class="uk-divider-icon">

    <div uk-grid>
      <div class="uk-width-1-4@m">
        {{ 'nano-mnemonic' | translate }}<br>
      </div>
      <div class="uk-width-3-4@m">
        <pre class="mne-box"><span *ngFor="let line of newWalletMnemonicLines; let l = index" class="mne-cont"><span *ngFor="let word of line; let i = index" class="mne-word"><span class="mne-num">{{ (l * 4) + i + 1 }}</span> {{ word }}</span></span></pre>
        <a title="Copy Mnemonic To Clipboard" ngxClipboard [cbContent]="newWalletMnemonic" (cbOnSuccess)="copied()" uk-tooltip>{{ 'copy-to-clipboard' | translate }}</a>
      </div>
    </div>
  </div>
  <div class="uk-card-footer">
    <div class="uk-width-1-1">
      <label style="cursor: pointer;"><input type="checkbox" class="uk-checkbox" [(ngModel)]="hasConfirmedBackup"> &nbsp; {{ 'i-have-securely-stored-the-seed-and-or-mnemonic' | translate }}</label>
    </div>
    <button class="uk-button uk-button-primary uk-width-auto@s uk-width-1-1" id="create-wallet" [disabled]="!hasConfirmedBackup" (click)="confirmNewSeed()">{{ 'create-wallet' | translate }}</button>
  </div>
</div>

<div class="uk-card uk-card-default" *ngIf="activePanel === panels.password">
  <div class="uk-card-header">
    <h3 class="uk-card-title">{{ 'set-wallet-password' | translate }}</h3>
  </div>
  <div class="uk-card-body">
    <p>
      {{ 'your-password-is-used-to-encrypt-the-sensitive-parts' | translate }}
    </p>

    <p>
      {{ 'for-the-safety-of-your-funds-use-a-secure-und-unique-password' | translate }}
    </p>
    <div uk-grid>
      <div class="uk-width-1-2@m">
        <input type="password" class="uk-input" [(ngModel)]="walletPasswordModel" placeholder="New Wallet Password">
        <password-strength-meter *ngIf="walletPasswordModel.length > 0" [password]="walletPasswordModel" [enableFeedback]="true" [minPasswordLength]="6"></password-strength-meter>
        <span class="password-helper" *ngIf="walletPasswordModel.length > 0 && walletPasswordModel.length < 6">{{ 'password-must-be-at-least-x-characters-long' | translate: { numchars: 6 } }}</span>
        <span class="password-helper" *ngIf="walletPasswordConfirmModel.length >= 6 && walletPasswordModel !== walletPasswordConfirmModel">{{ 'passwords-do-not-match' | translate }}</span>
      </div>
      <div class="uk-width-1-2@m">
        <input type="password" class="uk-input" (keyup.enter)="saveWalletPassword()" [(ngModel)]="walletPasswordConfirmModel" placeholder="Confirm Wallet Password">
      </div>
    </div>
  </div>
  <div class="uk-card-footer uk-text-right">
    <button class="uk-button uk-button-primary uk-width-auto@s uk-width-1-1" [disabled]="walletPasswordModel.length < 6 || (walletPasswordModel !== walletPasswordConfirmModel)" (click)="saveWalletPassword()">{{isNewWallet ? ('next' | translate):('import-wallet' | translate)}}</button>
  </div>
</div>

<div class="uk-card uk-card-default" *ngIf="activePanel === panels.final">
  <div class="uk-card-header">
    <h3 class="uk-card-title">{{ 'wallet-created' | translate }}</h3>
  </div>
  <div class="uk-card-body">
    <p>
      {{ 'your-wallet-has-been-created' | translate }}
    </p>
  </div>
  <div class="uk-card-footer uk-text-right">
    <button routerLink="/accounts" class="uk-button uk-button-primary uk-width-auto@s uk-width-1-1">{{ 'view-accounts' | translate }}</button>
  </div>
</div>

<div *ngIf="activePanel === panels.final && !walletService.isLedgerWallet()" class="uk-alert-primary" uk-alert>
  <p><strong>{{ 'protip' | translate }}</strong> {{ 'if-you-lose-your-password-you-can-always-restore' | translate }}</p>
</div>
<div *ngIf="activePanel === panels.final && walletService.isLedgerWallet()" class="uk-alert-primary" uk-alert>
  <p><strong>{{ 'protip' | translate }}</strong> {{ 'press-the-ledger-status-bar-on-the-left-side-to-reload' | translate }}</p>
</div>
